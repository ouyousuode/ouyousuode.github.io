---
layout: post
title: 单源最短路径之Dijkstra算法
---

{{page.title}}
====================

我刚搬进我的第一套公寓，在卡尔斯鲁厄。这样的大城市道路很复杂，虽然我有城市地图，但是怎样才能找到从A到B最快捷的路呢？我喜欢骑车但大家知道我耐心不足。我迫切需要知道到学校、到我女朋友住处以及其它经常去处的最短路径。

我可以按照如下方法一步步地解决这个问题：把地图平摊到桌上，用棉线沿着街道延伸；在街道交叉处打个结，另外在可能的起点和终点也上打上结，其结果如下图所示。

<img src="/images/posts/2018-10-10/dijkstraAlgorithm_00.jpg">
我的方法很巧妙：我抓住代表起点的结慢慢提起来。其它的结一个一个地先后离开桌面。每个结点我都做了标记，因此总能知道每个结在地图上原来的位置。最后，所有的结都竖直地垂在起点的下方。

这时，找最短路径真的很容易，找到终点，沿着垂挂它的直线回溯到起点。用皮尺量出两点之间的距离就可以了。怎样找到的路一定是最短路，因为如果还有更短的路，一定会把起点和终点拉得更近。

举例来说，如果我需要知道从M到F的最短路径。我抓住绳结M并将其它结提起离开桌面。下图显示了绳结F刚刚悬空时刻的场景。为了看得清楚，绳结画的水平方向有些间隔。灰色结点已经离开桌面，右边的数字指出到M的距离，每段绳长对应于上图中标示的道路距离。

<img src="/images/posts/2018-10-10/dijkstraAlgorithm_01.jpg">

显然,从M到F的最短路径经过G。L和K之间的那段绳子已经松弛，不可能拉直。这说明从M到任何一点的最短路径均不可能经过这一段。如果经过，就绕远了。

以上为单源最短路径的都市版，乡间版也很普遍。在农村，一个村子的村民居于宅基地，劳作于耕地。由于家庭联产承包制，家家户户都有自己的地块，各地块可能紧挨着，也可能被路隔开。劳作一天后，疲惫的村民想尽快回到家，假设地块标记从1到N,这些地块间共有T条路。现在帮助此疲惫的村民找到从地块N返回地块1的最短距离。我们将问题简单地抽象为：节点1(家)，节点2...节点6(目的地)，求从节点6到节点1的最短距离。

<img src="/images/posts/2018-10-10/dijkstraAlgorithm_03_Small.jpg">

图中，起点为1，终点为6。不管1和6中间有多少个点，也不论它们之间的链接是怎样的，目标只有一个，即从6到1的路径距离最短即可！

在道路繁多的城市地图上找出到任意目的地的最短路径，单靠棉线显然是效率低下的，其结果必是一团乱麻。想想地图软件，定位起点，输入目的地(终点)，软件即规划出此两点间的最短路径。

其实，计算机科学家Edsger Wybe Dijkstra早在1959年就提出了解决从一个顶点到其余各顶点的最短路径的算法以解决有向图中最短路径问题。因此，此算法也被称为Dijkstra's Algorithm。

<img src="/images/posts/2018-10-10/dijkstraAlgorithm_05.jpg">

Dijkstra算法中设置了一个顶点集合S，从源点s到集合中的顶点的最终最短路径的权值均已确定。算法反复选择具有最短路径估计的顶点u ∈ V-S，并将u加入S，对u的所有出边进行松弛。

- 第3行执行通常的d和π值的初始化。
- 第4行将集合S初始化为空集。
- 第5行初始化最小优先队列Q，使其包含V中所有顶点，因此时S=Ø。
- 第6到10行while循环到每次迭代开始，算法都保持着循环不变式Q=V-S。其每一轮迭代里，将一顶点u从Q=V-S中删除，并加入到集合S中。然后第9到10行对以u为起点的每条边(u,v)进行松弛。如果可以经过u来改进顶点v的最短路径的话，就对估计值d[v]以及前趋π(v)进行更新。

关于代码中的松弛技术，对每个顶点v ∈ V，都设置一个属性d[v]以描述从源点s到v的最短路径上权值的上限，此被称为最短路径估计。从代码中看到，用Initialize-Single-Source(G,s)来对最短路径估计和前驱进行初始化。经过初始化之后，对所有v ∈ V，π[v]=NIL，对v ∈ V-{s},有d[s]=0及d[v]= ∞。而松弛过程Relax(u,v,w)也可形象化为：

<img src="/images/posts/2018-10-10/dijkstraAlgorithm_04_Small.jpg">

此算法的主要特点是从源点开始向外层层扩展，直到扩到终点为止。先找到离源点最近的一个点near，然后以near为基地向外扩展，找到一个next，如果next距源点的距离已然最近，那就无则加勉；非最近，就有则改之。现在了解了Dijkstra算法的基本原理，可根据前文所提及的乡间版本写一段代码以enjoy之。数据输入格式为：
    
<img src="/images/posts/2018-10-10/dijkstraAlgorithm_06_Small.jpg">

然后，写代码处理这些数据：

<img src="/images/posts/2018-10-10/code_00.jpg">
<img src="/images/posts/2018-10-10/code_01.jpg">

当然，此代码只是直译了算法思想，肯定确有改进处，所以只可远观。另外，王垠推荐了一个对Dijkstra的采访视频，

<img src="/images/posts/2018-10-10/Dijkstra_Small.jpg">

翻译了作者的几个观点，挺有意思的，比如“研究物理的人如果遇到不理解的事情，总是可以责怪上帝，世界这么复杂不是你的错。但是如果你的程序有问题，那就找不到替罪羊了。0就是0，1就是1，就是你把它搞砸了。” 以及“为什么这么少的人追求优雅？这就是现实。如果说优雅也有缺点的话，那就是你需要艰巨的工作才能得到它，需要良好的教育才能欣赏它。”等等......

#### 参考资料
- 《Introduction to Algorithms》
- 《Algorithms Unplugged》








